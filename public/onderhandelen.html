<!DOCTYPE html>
<html ng-app="onderhandel">
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../less/navicoon.css"/>
    <link rel="stylesheet" type="text/css" href="../lib/semantic-ui/semantic.min.css">
    <link rel="stylesheet" type="text/css" href="../less/onderhandelen.css"/>
    <script src="../lib/jquery/jquery-2.1.4.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    <title></title>
</head>
<body>

<header>
    <div id="bovenbar">
        <div class="hamburger">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <img id="logo" src="../images/logo.png" >
        <div class="ui floating labeled icon dropdown button" id="rechterheader" ng-controller="userController">
            <i class="user icon"></i>
            <span class="text" id="user">{{ currentUser.local.voornaam || "user" }} </span>
            <input type="hidden" value="{{ currentUser._id }}" id="hiddenuserid">
            <input type="hidden" value="{{ currentUser.local.voornaam}}" id="currentUserVoornaam">
            <div class="menu">
                <div class="item" ng-show="loggedIn">
                    <i class="ticket icon"></i>
                    <a href="/mytickets">My Tickets</a>
                </div>
                <div class="item" ng-show="loggedIn">
                    <i class="exchange icon"></i>
                    <a href="/mytraded">My Trades</a>
                </div>
                <div class="item" ng-show="loggedIn">
                    <i class="sign out icon"></i>
                    <a href="/logout">Sign Out</a>
                </div>

                <div class="item" ng-hide="loggedIn">
                    <i class="sign in icon"></i>
                    <a href="/login">Sign In</a>
                </div>
                <div class="item" ng-hide="loggedIn">
                    <i class="add user icon"></i>
                    <a href="/signup">Register</a>
                </div>
            </div>
        </div>
    </div>
    <div class="zijmenu">
        <!-- Menu -->
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/werking">Werking</a></li>
            <li><a href="/overzichttickets">Browse Tickets</a></li>
            <li><a href="/mytickets">My tickets</a></li>
            <li><a href="/ticketregistreren">Add ticket</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
    </div>
</header>


<h1 id="h1tje">Negotiate & Trade</h1>


<div ng-controller="verzoekController"  >
    <input type="hidden" value="{{ tickets[0]['user'] }}" id="userIdJezelf">
    <input type="hidden" value="{{ tickets[1]['user'] }}" id="userIdAnder">
</div>

<div id="messagebox">
    <div id="bovenste">
        <p>Live Chat</p>
    </div>
    <div id="messages"></div>
</div>
<div id="onderste">
    <input id="typeit">
    <input type="button" id="sendit" value="Send">
</div>


   <script src="../js/navnavigatie.js"></script>
   <script src="../js/semanticinits.js"></script>
   <script src="../lib/semantic-ui/semantic.min.js"></script>
   <script src="../lib/angular/angular.js"></script>
   <script src="../lib/angular/angular-route.js"></script>
   <script src="../controllers/clientOnderhandelController.js"></script>
   <script src="/socket.io/socket.io.js"></script>
   <script src="../js/overzichtticketssocket.js"></script>
   <script src="../js/notificatieRequestSocket.js"></script>
<script>

    window.onload = function () {
        var socket = io.connect();
        socket.on("connect",function(){
            console.log("connected");
        });

        socket.on("disconnect",function(){
            console.log("disconnected");
        });

        setTimeout(
                function()
                {
                    var userIdJezelf = document.getElementById("userIdJezelf").value;
                    var userIdAnder = document.getElementById("userIdAnder").value;
                    var naamAnder = document.getElementById("currentUserVoornaam").value;
                    var eigenID = document.getElementById("hiddenuserid").value;
                    var echteID;
                    console.log("userIdJezelf "+userIdJezelf);
                    console.log("userIdAnder "+userIdAnder);
                    console.log("naamAnder "+naamAnder);
                    var ids = [userIdJezelf,userIdAnder];
                    for(var i = 0; i < ids.length; i++){
                        if(ids[i] == eigenID){

                        }else{
                            echteID = ids[i];
                        }
                    }
                    var msg = [eigenID,echteID,naamAnder];
                    if(msg){
                        socket.emit("tradenotaccept",msg);
                        console.log("de shit is verstuurd");
                    }
                }, 2000);

        document.getElementById("sendit").addEventListener("click",function(evt){
            var tekst = document.getElementById("typeit").value;
            var verzender = document.getElementById("currentUserVoornaam").value;
            var msg = [tekst,verzender];
            if(msg){
                socket.emit("typeit",msg);
                document.getElementById("messages").innerHTML += "You said: "+msg[0] + "<br>";
                //document.getElementById("typeit").value = "";
            }
        },false)

        function scrollToBottom(){

        }
        socket.on("messages",function(msg){
            document.getElementById("messages").innerHTML +=msg[1]+": "+ msg[0] + "<br>";
            console.log("blabla");
            document.getElementById("messages").append("<div>hello world</div>");
            console.log("hoi");
        });
    }

</script>
</body>
</html>